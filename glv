#!/usr/bin/env bash
#
# Golang Latest Version Manager
# Should work on sh, dash, bash, ksh, zsh
#
# Copyright (C) 2021-present, Implemented by Bin Hua <forhua@gmail.com>

golang_version_remote() {
  curl -s https://golang.org/VERSION?m=text | sed -e 's/^go//'
}

golang_version_local() {
  go version | awk '{print $3}' | sed -e 's/go//'
}

golang_is_installed() {
  if [[ $(command -v go) ]]; then
    return 0
  else
    return 1
  fi
}

system_type() {
  if [[ "$(uname)" = "Darwin" ]] ;then
      echo "darwin-amd64"
  elif [[ "$(uname)" = "Linux" ]]; then
    if [[ "$(getconf LONG_BIT)" = "64" ]]; then
      echo "linux-amd64"
    else
      echo "linux-386"
    fi
  elif [[ "$(uname)" = "MINGW32_NT" ]]; then
    echo -e "Please go to https://golang.org/dl/" && exit 1
  else
    echo -e "System unsupported" && exit 1
  fi
}

golang_version_file() {
  curl -LO https://golang.org/dl/$(golang_version_remote).$(system_type).tar.gz
}

current_shell_type() {
  
}

opt_golang(){
  golang_version_file
  if golang_is_installed; then
    echo "golang is installed"
  else
    echo "golang is not installed"
    echo "downloading golang"
  fi
}

set_gopath() {
  echo "hello1"
}

glv_version() {
  echo "v0.1.1"
}

glv_help() {
  echo
  echo "Golang Latest Version Manager ($(glv_version))"
  echo
  echo "Usage: glv [OPTION]..."
  echo "Options:"
  echo "  -i, --install      Install/Update Golang"
  echo "  -s, --setgopath    Set GOPATH"
  echo "  -h, --help         Show help information"
  echo "  -v, --version      Show GLV version"
  echo
}

main(){
  if  [[ $(command -v glv) ]]; then
    case $1 in
      -i|--install)
        opt_golang
        exit 0
        ;;
      -s|--setgopath)
        set_gopath
        exit 0
        ;;
      -h|--help)
        glv_help
        exit 0
        ;;
      -v|--version)
        echo $(glv_version)
        exit 0
        ;;
      *)
        glv_help
        exit 1
        ;;
    esac
  else
    sudo curl -sL https://raw.githubusercontent.com/tourcoder/glv/master/glv -o /usr/local/bin/glv
    sudo chmod +x /usr/local/bin/glv
    echo -e "glv installed, just run 'glv --help'" && exit 1
  fi
}

main $1